(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wc.wcBlocksRegistry,n=window.wp.htmlEntities,r=window.wc.wcSettings,o=window.wp.element,c=window.wc.blocksCheckout,m=({field:t,setPaymentData:a,paymentData:n})=>{const r=n.hasOwnProperty(t.key)?n[t.key]:"",[m,l]=(0,o.useState)(r),i="german-market-sepa-field "+t.key;let s=t.label;return t.required&&(s+=" *"),(0,e.createElement)(c.ValidatedTextInput,{className:i,id:t.key,label:s,value:m,required:!1,onChange:e=>{((e,t)=>{l(e),a(t,e)})(e,t.key)},errorId:t.key,customValidation:e=>!t.required||""!=e.value||(e.setCustomValidity(t.error_message),!1)})},l=window.wp.data,i=window.wc.priceFormat,s=({paymentSettings:t,WooCommerceData:a,setPaymentData:n,paymentData:m})=>{let s=(0,e.createElement)(e.Fragment,null);const{setValidationErrors:d,clearValidationError:p}=(0,l.useDispatch)("wc/store/validation"),g="german-market-sepa-checkbox-mandate",[_,u]=(0,o.useState)(!1),y=a.activePaymentMethod;let k=!1;const b=(0,r.getSetting)("german-market-blocks_data");(0,o.useEffect)((()=>{if("german_market_sepa_direct_debit"===y&&"activated"===t.checkbox_confirmation&&!_&&"on"!==b.manual_order_confirmation)return d({[g]:{message:"error",hidden:!0}}),void(k=!0);p(g)}),[p,g,d,_,y]),(0,o.useEffect)((()=>()=>{p(g)}),[p,g]);const{validationError:w}=(0,l.useSelect)((e=>({validationError:e("wc/store/validation").getValidationError(g)})));if("activated"===t.checkbox_confirmation){let r=t.mandate_text;const o=t.close_text;r=r.replace(/\[creditor_information\]/g,t.creditor_information),r=r.replace(/\[creditor_identifier\]/g,t.creditor_identifier),r=r.replace(/\[creditor_account_holder\]/g,t.creditor_account_holder),r=r.replace(/\[creditor_iban\]/g,t.creditor_iban),r=r.replace(/\[creditor_bic\]/g,t.creditor_bic),r=r.replace(/\[mandate_id\]/g,t.mandate_id),r=r.replace(/\[date\]/g,t.date_info);const l=m.hasOwnProperty("german-market-sepa-holder")?m["german-market-sepa-holder"]:"",d=m.hasOwnProperty("german-market-sepa-iban")?m["german-market-sepa-iban"]:"",p=m.hasOwnProperty("german-market-sepa-bic")?m["german-market-sepa-bic"]:"";r=r.replace(/\[account_holder\]/g,l),r=r.replace(/\[account_iban\]/g,d),r=r.replace(/\[account_bic\]/g,p);const y=a.billing.billingData.address_1,b=a.billing.billingData.postcode,E=a.billing.billingData.city,h=a.billing.billingData.country;r=r.replace(/\[street\]/g,y),r=r.replace(/\[postcode\]/g,b),r=r.replace(/\[city\]/g,E),r=r.replace(/\[country\]/g,h);const v=a.billing.cartTotal.value,D=a.billing.currency,f=(0,i.formatPrice)(v,D);if(r=r.replace(/\[amount\]/g,f),""!=l&&""!=d&&""!=p&&""!=y&&""!=b&&""!=E&&""!=h){!1===w?.hidden&&(k=!0);const a=()=>{document.getElementById("gm-sepa-mandate-preview-text").style.display="none"};s=(0,e.createElement)(e.Fragment,null,(0,e.createElement)(c.CheckboxControl,{id:g,checked:_,onChange:e=>{u(e),((e,a)=>{n(a,e),n(a+"-text",e?t.checkbox_text:"")})(e,g)},hasError:k},(0,e.createElement)("span",{className:"german-market-checkbox",dangerouslySetInnerHTML:{__html:t.checkbox_text}})),(0,e.createElement)("div",{id:"gm-sepa-mandate-preview-text",style:{display:"none"}},(0,e.createElement)("div",{className:"close",onClick:a},o),(0,e.createElement)("div",{className:"gm-sepa-mandate-preview-inner",dangerouslySetInnerHTML:{__html:r}})))}}return s},d=({paymentSettings:t,setPaymentData:a})=>{let n=(0,e.createElement)(e.Fragment,null);const r="german-market-sepa-save-payment-information",[m,l]=(0,o.useState)(!1);return n=(0,e.createElement)(e.Fragment,null,(0,e.createElement)(c.CheckboxControl,{id:r,checked:m,onChange:e=>{l(e),((e,t)=>{a(t,e?"yes":"no")})(e,r)}},(0,e.createElement)("span",{className:"german-market-checkbox",dangerouslySetInnerHTML:{__html:t.save_data_checkbox_text}}))),n},p=window.wp.components,g=({paymentSettings:t,WooCommerceData:a,setPaymentData:n,paymentData:r,MaybeFieldsComponent:c})=>{const[m,l]=(0,o.useState)("saved"),i="new"===m?c:(0,e.createElement)(e.Fragment,null),d="saved"===m?(0,e.createElement)(s,{paymentSettings:t,WooCommerceData:a,setPaymentData:n,paymentData:t.user_saved_data}):(0,e.createElement)(e.Fragment,null);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"german-market-sepa-radio-controls"},(0,e.createElement)(p.RadioControl,{selected:m,options:[{label:t.used_stored_data_text+"\n"+t.user_has_saved_data,value:"saved"},{label:t.use_new_data_text,value:"new"}],onChange:e=>{l(e),(e=>{n("german-market-sepa-use-payment-information",e)})(e)}})),d,i)},_=(0,r.getSetting)("german_market_sepa_direct_debit_data",{}),u=(0,r.getSetting)("german-market-blocks_data"),y=(0,t.__)("Sepa Direct Debit","woocommerce-german-market"),k=(0,n.decodeEntities)(_.title)||y,b=_.fields,w=Object.values(b);let E={german_market_sepa_block:"yes"};const h=t=>{const{eventRegistration:a,emitResponse:n}=t,{onPaymentSetup:r}=a;(0,o.useEffect)((()=>{const e=r((async()=>({type:n.responseTypes.SUCCESS,meta:{paymentMethodData:E}})));return()=>{e()}}),[n.responseTypes.ERROR,n.responseTypes.SUCCESS,r,E]);const c=(e,t)=>{E[e]=t};let l=(0,e.createElement)(e.Fragment,null),i=(0,e.createElement)(e.Fragment,null);_.can_save_data&&"on"!==u.manual_order_confirmation&&(i=(0,e.createElement)(d,{paymentSettings:_,setPaymentData:c}));let p=(0,e.createElement)(e.Fragment,null,w.map((t=>(0,e.createElement)(m,{key:t.key,field:t,setPaymentData:c,paymentData:E}))),i,(0,e.createElement)(s,{paymentSettings:_,WooCommerceData:t,setPaymentData:c,paymentData:E}));return!_.can_save_data||_.can_save_data&&""===_.user_has_saved_data?l=p:(E.hasOwnProperty("german-market-sepa-use-payment-information")||(E["german-market-sepa-use-payment-information"]="saved"),l=(0,e.createElement)(e.Fragment,null,(0,e.createElement)(g,{paymentSettings:_,WooCommerceData:t,setPaymentData:c,paymentData:E,MaybeFieldsComponent:p}))),l},v={name:"german_market_sepa_direct_debit",label:(0,e.createElement)((t=>{const{PaymentMethodLabel:a}=t.components;return(0,e.createElement)(a,{text:k})}),null),content:(0,e.createElement)(h,null),edit:(0,e.createElement)(h,null),canMakePayment:()=>!0,ariaLabel:k,supports:{features:_.supports}};(0,a.registerPaymentMethod)(v)})();